name: DepositWithdrawal Test

on:
  push:
    paths:
      - 'op-chain-ops/**'
      - 'op-node/**'
      - 'packages/**'
      - 'packages/tokamak/contracts-bedrock/**'

jobs:
  env-setting:
    name: Os-Stetting
    runs-on: ubuntu-latest

    steps:
          - name: Checkout
            uses: actions/checkout@v3

          # Declares the repository safe and not under dubious ownership.
          - name: Add repository to git safe directories
            run: git config --global --add safe.directory $GITHUB_WORKSPACE

          - name: Restore PNPM Package Cache
            uses: actions/cache@v3
            with:
              path: node_modules
              key: pnpm-packages-v2-${{ hashFiles('pnpm-lock.yaml') }}

          - name: Fetch dependencies
            run: pnpm fetch --frozen-lockfile --prefer-offline

          - name: Save PNPM Package Cache
            uses: actions/cache@v3
            with:
              path: node_modules
              key: pnpm-packages-v2-${{ hashFiles('pnpm-lock.yaml') }}

          - name: Install dependencies
            run: pnpm install --frozen-lockfile --offline

          - name: Setup Node.js
            uses: actions/setup-node@v3
            with:
              node-version: '20'

          - name: Setup Python
            uses: actions/setup-python@v3
            with:
              python-version: '3.9'

          - name: Setup Go
            uses: actions/setup-go@v3
            with:
              go-version: '1.21'

          - name: install pnpm
            run: npm install -g pnpm@8

          - name: Install Git
            run: |
              sudo add-apt-repository ppa:git-core/ppa
              sudo apt-get update
              sudo apt-get install git=2.*

          - name: Install Make
            run: |
              sudo apt-get install make=4.*

          - name: Install Geth
            run: |
              sudo add-apt-repository -y ppa:ethereum/ethereum
              sudo apt-get update
              sudo apt-get install geth=1.10.13

          - name: Install Foundry
            run: |
              sudo apt-get update
              sudo apt-get install foundry
              npm run update:foundry


          - name: Verify versions
            run: |
              git --version
              go version
              node --version
              pnpm --version
              make --version
              geth version
              forge --version

          - name: build necessary files for @eth-optimism/core-utils
            run: |
              pnpm run build

  run-devnet:
    name: run local devnet
    runs-on: ubuntu-latest

    steps:
          - name: Checkout
            uses: actions/checkout@v3

          - name: creat local devnet
            run: |
              make devnet-up

  run-Test:
    name: run Deposit&withdrawal Test
    runs-on: ubuntu-latest

    steps:
          - name: Checkout
            uses: actions/checkout@v3

          - name: cd to tokamak-titan-canyon/packages/sdk and execute test code
            run: |
              cd packages/sdk
              npx hardhat deposit-eth --amount 40 --to 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC --network devnetL1







